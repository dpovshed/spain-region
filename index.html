<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Выбор региона Испании</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<style>
		h1 {
			font-size: 5.9vw;
		}
		h2 {
			font-size: 3.0vh;
		}
		p {
			font-size: 2vmin;
		}

		button.option {
			width: 80%;
		}

		@media only screen and (max-width: 700px) {
			p {
				font-size: 4vmin;
			}

			button {
				font-size: 4vmin;
			}

			button.option {
				width: 100%;
			}
		}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
		var Spain = {
			"data" : [
				{
					"name": "Андалусия",
					"mapUrl":"https://goo.gl/maps/XV3ptimN1252",
					"params": {
						"density": 0.1180184255,
						"unemployment": 0.3941874744,
						"crime": 0.8902397604,
						"salary": 0.775481107,
						"housing": 0.4798387016,
						"prices": 0.347826087,
						"russian": 0.5315530863,
						"sunnydays": 1,
						"temperature": 0.9074772043,
						"precipitation": 0.6341464604,
						"sea": 0.75
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.andalucia.org/"
				},
				{
					"name": "Арагон",
					"mapUrl":"https://goo.gl/maps/UK6UcTpnSe52",
					"params": {
						"density": 0.0338353392,
						"unemployment": 0.8469656992,
						"crime": 0.7176266804,
						"salary": 0.8097975758,
						"housing": 0.629629619,
						"prices": 0.3418803419,
						"russian": 0.0560408504,
						"sunnydays": 0.8240843845,
						"temperature": 0.751132817,
						"precipitation": 0.6335810996,
						"sea": 0
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.aragon.es/"
				},
				{
					"name": "Астурия",
					"mapUrl":"https://goo.gl/maps/4x25Lxckri62",
					"params": {
						"density": 0.1204115427,
						"unemployment": 0.6577868852,
						"crime": 0.8825898883,
						"salary": 0.8278917469,
						"housing": 0.9153846,
						"prices": 0.350877193,
						"russian": 0.0232513328,
						"sunnydays": 0.5267111724,
						"temperature": 0.6272657663,
						"precipitation": 0.2086922866,
						"sea": 0.75
					},
					"langs" :[
						"испанский"
					],
					"url": "https://www.asturias.es/"
				},
				{
					"name": "Балеарские острова",
					"mapUrl":"https://goo.gl/maps/2Hgk5AAxPwH2",
					"params": {
						"density": 0.275805869,
						"unemployment": 0.7636796193,
						"crime": 0.9679973374,
						"salary": 0.7760030263,
						"housing": 0.434306562,
						"prices": 0.3669724771,
						"russian": 0.072194746,
						"sunnydays": 0.8605867762,
						"temperature": 0.8598941299,
						"precipitation": 0.4710562086,
						"sea": 0.75
					},
					"langs" :[
						"испанский", "каталанский"
					],
					"url": "http://www.illesbalears.travel"
				},
				{
					"name": "Канарские острова",
					"mapUrl":"https://goo.gl/maps/oQEa9XG5Krm",
					"params": {
						"density": 0.3492435992,
						"unemployment": 0.4369328494,
						"crime": 1,
						"salary": 0.7201910247,
						"housing": 0.4576923,
						"prices": 0.4166666667,
						"russian": 0.0860202967,
						"sunnydays": 0.8883924879,
						"temperature": 1,
						"precipitation": 1,
						"sea": 0.75
					},
					"langs" :[
						"испанский"
					],
					"url": "https://www.holaislascanarias.com/"
				},
				{
					"name": "Кантабрия",
					"mapUrl":"https://goo.gl/maps/EqLCC7WDqpM2",
					"params": {
						"density": 0.1345457067,
						"unemployment": 0.7138621201,
						"crime": 0.8406986108,
						"salary": 0.7927374506,
						"housing": 0.8749999853,
						"prices": 0.4166666667,
						"russian": 0.0597662021,
						"sunnydays": 0.4523161034,
						"temperature": 0.6827793531,
						"precipitation": 0.1945966046,
						"sea": 0.75
					},
					"langs" :[
						"испанский", "кантабрийский"
					],
					"url": "https://turismodecantabria.com/"
				},
				{
					"name": "Кастийя и Леон",
					"mapUrl":"https://goo.gl/maps/hmVTgq9GvJD2",
					"params": {
						"density": 0.0317620049,
						"unemployment": 0.7024070022,
						"crime": 0.6223843609,
						"salary": 0.772400731,
						"housing": 1,
						"prices": 0.3571428571,
						"russian": 0.0447042199,
						"sunnydays": 0.8018398152,
						"temperature": 0.6053624463,
						"precipitation": 0.6094912521,
						"sea": 0
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.turismocastillayleon.com/"
				},
				{
					"name": "Кастийя Ла Манча",
					"mapUrl":"https://goo.gl/maps/rnX3Em4sjdm",
					"params": {
						"density": 0.0315407914,
						"unemployment": 0.4878419453,
						"crime": 0.587770095,
						"salary": 0.7497122915,
						"housing": 0.8150684795,
						"prices": 0.3921568627,
						"russian": 0.0906288137,
						"sunnydays": 0.8059515109,
						"temperature": 0.6733382669,
						"precipitation": 0.6612904467,
						"sea": 0
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.castillalamancha.es/"
				},
				{
					"name": "Каталония",
					"mapUrl":"https://goo.gl/maps/2ZMQ4FQiT4x",
					"params": {
						"density": 0.29027897,
						"unemployment": 0.7624703088,
						"crime": 0.8485957492,
						"salary": 0.8821332755,
						"housing": 0.2786885199,
						"prices": 0.3418803419,
						"russian": 1,
						"sunnydays": 0.5867596774,
						"temperature": 0.7922959528,
						"precipitation": 0.6582279716,
						"sea": 0.75
					},
					"langs" :[
						"испанский", "каталанский"
					],
					"url": "http://www.catalunya.com/"
				},
				{
					"name": "Валенсия",
					"mapUrl":"https://goo.gl/maps/4c88fMcfyS22",
					"params": {
						"density": 0.2621546235,
						"unemployment": 0.5745823389,
						"crime": 0.9544751278,
						"salary": 0.7593186541,
						"housing": 0.5483870876,
						"prices": 1,
						"russian": 0.7724645128,
						"sunnydays": 0.8065135412,
						"temperature": 0.8685799292,
						"precipitation": 0.5076191429,
						"sea": 0.75
					},
					"langs" :[
						"испанский", "валенсийский"
					],
					"url": "http://www.comunitatvalenciana.com/"
				},
				{
					"name": "Экстремадура",
					"mapUrl":"https://goo.gl/maps/SXhGxGw5LFD2",
					"params": {
						"density": 0.0320005705,
						"unemployment": 0.3833598726,
						"crime": 0.7484206298,
						"salary": 0.7095959532,
						"housing": 0.434306562,
						"prices": 0.4255319149,
						"russian": 0.0074185882,
						"sunnydays": 0.8856414973,
						"temperature": 0.8232627155,
						"precipitation": 0.6892985451,
						"sea": 0
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.turismoextremadura.com/"
				},
				{
					"name": "Галисия",
					"mapUrl":"https://goo.gl/maps/pLZ2i6Gw6g42",
					"params": {
						"density": 0.1129776521,
						"unemployment": 0.6546566961,
						"crime": 0.7196239728,
						"salary": 0.7480438906,
						"housing": 0.6878612601,
						"prices": 0.3418803419,
						"russian": 0.0262219796,
						"sunnydays": 0.6528130329,
						"temperature": 0.6895769351,
						"precipitation": 0.1832245101,
						"sea": 0.75
					},
					"langs" :[
						"испанский", "галисийский"
					],
					"url": "http://www.turismo.gal/"
				},
				{
					"name": "Мадрид",
					"mapUrl":"https://goo.gl/maps/4DvdvHmCZkq",
					"params": {
						"density": 1,
						"unemployment": 0.7003636364,
						"crime": 0.7538825622,
						"salary": 0.9592594621,
						"housing": 0.2306201512,
						"prices": 0.4395604396,
						"russian": 0.5341222943,
						"sunnydays": 0.8059515109,
						"temperature": 0.7515104605,
						"precipitation": 0.7658047414,
						"sea": 0
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.madrid.org/"
				},
				{
					"name": "Мурсия",
					"mapUrl":"https://goo.gl/maps/tJsPQFGYXA32",
					"params": {
						"density": 0.1603230928,
						"unemployment": 0.5595583963,
						"crime": 0.9195687687,
						"salary": 0.7590854406,
						"housing": 0.6197916563,
						"prices": 0.3571428571,
						"russian": 0.152065001,
						"sunnydays": 0.9413120817,
						"temperature": 0.9078548478,
						"precipitation": 0.9014800846,
						"sea": 0.75
					},
					"langs" :[
						"испанский"
					],
					"url": "https://www.murciaturistica.es/"
				},
				{
					"name": "Наварра",
					"mapUrl":"https://goo.gl/maps/bsDrn2BZbDT2",
					"params": {
						"density": 0.0763705507,
						"unemployment": 1,
						"crime": 0.6741125522,
						"salary": 0.9018062617,
						"housing": 0.951999984,
						"prices": 0.347826087,
						"russian": 0.0449611407,
						"sunnydays": 0.5519433767,
						"temperature": 0.6051907902,
						"precipitation": 0.2632099259,
						"sea": 0
					},
					"langs" :[
						"испанский", "баскский"
					],
					"url": "http://www.navarra.es/"
				},
				{
					"name": "Страна Басков",
					"mapUrl":"https://goo.gl/maps/PN519k3vu8E2",
					"params": {
						"density": 0.3741999007,
						"unemployment": 0.9110690634,
						"crime": 0.7574436869,
						"salary": 1,
						"housing": 0.5534883628,
						"prices": 0.3773584906,
						"russian": 0.0744267455,
						"sunnydays": 0.4410754965,
						"temperature": 0.6895769351,
						"precipitation": 0.1832245101,
						"sea": 0.75
					},
					"langs" :[
						"испанский", "баскский"
					],
					"url": "http://www.euskoguide.com/es/"
				},
				{
					"name": "Ла Риоха",
					"mapUrl":"https://goo.gl/maps/66AkRSWvaTw",
					"params": {
						"density": 0.0771238373,
						"unemployment": 0.8366637706,
						"crime": 0.8569181025,
						"salary": 0.7891097666,
						"housing": 0.572115375,
						"prices": 0.3738317757,
						"russian": 0.0345397906,
						"sunnydays": 0.7302844785,
						"temperature": 0.6563443117,
						"precipitation": 0.4898897978,
						"sea": 0
					},
					"langs" :[
						"испанский"
					],
					"url": "http://www.larioja.org/"
				}
			],
			"questions": [
				{
					"name": "density",
					"brief": "Плотность населения",
					"description": "Насколько важна высокая плотность населения в регионе? Вам нравится наличие большого количества людей " +
								   "или предпочитаете возможность уедениться? Учитываются только постоянно проживающие жители, без учёта туристов.",
					"options": [
						{
							"text": "Чем меньше, тем лучше",
							"value": 0.5
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Люблю, когда много народу",
							"value": 2.5
						}
					]
				},
				{
					"name": "unemployment",
					"brief": "Работа и количество безработных",
					"description": "В регионах с высокой безработицей меньше шансов найти работу, но если вы работаете удалённо, то " +
								   "скорее всего вас это не инетерсует",
					"options": [
						{
							"text": "Не интересует испанская работа",
							"value": 0
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Нужна работа на месте",
							"value": 2.5
						}
					]
				},
				{
					"name": "crime",
					"brief": "Безопасность и уровень преступности",
					"description": "В Испании в целом уровень преступности достаточно низок, но тем не менее, все регионы отличаются и по этому показателю.",
					"options": [
						{
							"text": "Испанская преступность мне не страшна",
							"value": 0
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Хочу, чтобы было максимально безопасно",
							"value": 2.5
						}
					]
				},
				{
					"name": "salary",
					"brief": "Средняя заработная плата",
					"description": "Уровень средней заработной платы влияет и на платежеспособность населения, и на оплату работ нелегальных работников в том числе.",
					"options": [
						{
							"text": "Не интересует испанская зарплата",
							"value": 0
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Чем больше платят, тем лучше",
							"value": 2.5
						}
					]
				},
				{
					"name": "housing",
					"brief": "Рост цен на недвижимость",
					"description": "Рост цен на недвижимость влияет на стоимость аренды в том числе. Показатель включает цены как на вторичное, так и на новое жильё.",
					"options": [
						{
							"text": "У меня свое жилье",
							"value": 0
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Хочу платить за жильё как можно меньше",
							"value": 2.5
						}
					]
				},
				{
					"name": "prices",
					"brief": "Индекс потребительских цен",
					"description": "ИПЦ отражает рост цен на товары(включая импортные) и услуги в регионе, отражается даже на ценах в крупных торговых сетях.",
					"options": [
						{
							"text": "Трачу деньги не особо задумываясь",
							"value": 0.25
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Хочу, по возможности, экономить",
							"value": 2.5
						}
					]
				},
				{
					"name": "russian",
					"brief": "Наличие русскоговорящего сообщества",
					"description": "Чем больше русскоговорящее сообщество в регионе, тем проще найти работу без знания языка. " +
								   "Также отражается на наличии магазинов с соответствующими товарами и услуг на русском языке.",
					"options": [
						{
							"text": "Не хочу жить с русскоговорящими",
							"value": -0.5
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Чем больше \"советских\" людей, тем лучше",
							"value": 2.5
						}
					]
				},
				{
					"name": "sunnydays",
					"brief": "Количество солнечных часов в году",
					"description": "Испания в целом достаточно солнечная страна, но от региона к региону количество солнечных часов достаточно сильно разнится.",
					"options": [
						{
							"text": "Не люблю солнце",
							"value": -0.5
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Хочу максимально солнечную Испанию",
							"value": 2.5
						}
					]
				},
				{
					"name": "temperature",
					"brief": "Средняя температура воздуха",
					"description": "Вы любите жаркое лето и тёплую зиму? Или предпочитаете, чтобы летом было нежарко? " +
								   "Зимы в Испании во всех регионах относительно тёплые, но всё-таки есть разброс средних температур порядка 10-15 градусов.",
					"options": [
						{
							"text": "Не люблю жару",
							"value": -0.25
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Люблю, когда тепло, и летом, и зимой",
							"value": 2.5
						}
					]
				},
				{
					"name": "precipitation",
					"brief": "Влажность и количество осадков",
					"description": "От количества осадков очень сильно зависит уровень влажности. Во влажном климате жара и холод воспринимаются сильнее, нежели в сухом.",
					"options": [
						{
							"text": "Ничего против дождя не имею",
							"value": 0.25
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Люблю, когда сухо",
							"value": 2.5
						}
					]
				},
				{
					"name": "sea",
					"brief": "Наличие выхода к морю",
					"description": "Для многих море это несомненный плюс Испании. Нужно учитывать, что многие регионы имею очень небольшу " +
								   "прибрежную зону, а также то, что море даёт дополнительную влажность.",
					"options": [
						{
							"text": "Мне и без моря хорошо",
							"value": -1
						},
						{
							"text": "Без разницы",
							"value": 1
						},
						{
							"text": "Обязательно море, хочу на пляж",
							"value": 2
						}
					]
				}
			]
		};

		Spain.calculateRegions = function() {
			var regions = [];

			var weights = !this.weights ? {} : this.weights;

			this.data.forEach(
				function (region) {
					var score = 0;

					for (var param in region.params) {
						var weight = isNaN(weights[param]) ? 1 : weights[param];

						score += region.params[param] * weight;
					}

					region.score = score;

					regions.push(region);
				}
			)

			regions.sort(
				function (region1, region2) {
					return region2.score < region1.score ? -1 :
						region2.score == region1.score ? 0 : 1;
				}
			)

			return regions;
		};

		Spain.nextQuestion = function() {
			var viewport = $('.viewport');

			var current = !viewport.data('question') ? 0 : viewport.data('question');

			if (current == 0) {
				this.weights = {};
			}

			var question = this.questions[current];

			var div = $('<div class="col-md-5 col-xs-11 col-lg-4 viewport" style="margin: 0 auto; float: none;"></div>').append(
				$('<p class="text-center"></p>').append(
					$('<h4></h4>').text(question.brief)));

			div.append($('<p class="text-justify text-muted"></p>').text(question.description));

			var instance = this;

			question.options.forEach(
				function(option) {
					var button = $('<button class="btn btn-primary option" style="margin-right:5px; margin-top:5px; font-size: 2rem;"></button>');

					button.text(option.text);

					button.on(
						'click',
						function() {
							instance.weights[question.name] = option.value;

							if (current == instance.questions.length) {
								instance.showResults();
							}
							else {
								instance.nextQuestion();
							}

						}
					)

					div.append($('<br/>'));
					div.append(button);
				}
			);

			div.data('question', ++current);

			viewport.replaceWith(div);
		};

		Spain.showResults = function() {
			var regions = this.calculateRegions();

			var viewport = $('.viewport');

			var div = $('<div class="col-md-5 col-xs-11 col-lg-4 text-center table-responsive viewport" style="margin: 0 auto; float: none;"></div>');

			div.append($('<h4></h4>').text('Готово!'));
			div.append($('<p class="text-justify text-info"></p>').html(
				'Наиболее подходящим регионом Испании для вас является <b>' +
				regions[0].name + '</b>, но также стоит обратить внимание на ТОП-5 регионов, подобранных по вашим ответам.'
			));

			var table = $('<table class="table table-bordered"></table>');

			var header = $('<thead></thead>');
			var headerRow = $('<tr></tr>');
			headerRow.append($('<th></th>').text('Автономия'));
			headerRow.append($('<th></th>').text('На Google - картах'));
			headerRow.append($('<th></th>').text('Официальный сайт'));
			headerRow.append($('<th></th>').text('Официальные языки'));

			header.append(headerRow);
			table.append(header);

			var body = $('<tbody></tbody>');

			regions.forEach(
				function(region, index) {
					var rowClass = (index <= 4) ? 'success' :
						(index > 10  && index < 14) ? 'warning' :
							(index > 13) ? 'danger' : 'info';

					var row = $('<tr class="' + rowClass + '"></tr>');

					row.append($('<td></td>').text(region.name));
					row.append($('<td></td>').html('<a href="' + region.mapUrl +'">Показать на карте</a>'));
					row.append($('<td></td>').html('<a href="' + region.url +'">Оф. сайт</a>'));
					row.append($('<td></td>').text(region.langs.join(', ')));

					body.append(row);
				}
			);

			table.append(body);

			div.append($('<br/>'));
			div.append(table);
			div.append($('<br/>'));

			var button = $('<button class="btn btn-primary btn-lg">Подобрать еще раз</button>');

			viewport.data('question', 0);

			var instance = this;

			button.on(
				'click',
				function () {
					instance.nextQuestion();
				}
			);

			div.append(button);

			viewport.replaceWith(div);
		};
	</script>
</head>
<body>
	<div class="text-center">
		<h3>Выбор региона Испании</h3>

		<br/>

		<p class="text-primary text-justify col-md-4 col-xs-10 col-lg-3" style="margin: 0 auto; float: none;">
			Данный инструмент позволит вам подобрать наиболее подходящий регион Испании для жизни.
			Для подготовки инструмента использовались только официальные данные испанского института статистики <a href="http://www.ine.es">INE</a>
			за последний доступный период.
		</p>

		<br/>

		<div class="viewport">
			<button class="btn btn-primary btn-lg" onclick="Spain.nextQuestion()" style="font-size: 3rem;">
				Подобрать регион
			</button>
		</div>
	</div>
	<br/>
	<footer class="text-center">
		&copy; Pavel Savinov, 2018, <a href="http://youtube.com/pavelsavinov.es">http://youtube.com/pavelsavinov.es</a>
	</footer>
</body>
</html>